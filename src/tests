// -*- c -*-

// This is a line comment.

/*
 * This is a block comment.
 */

int assert(int expected, int actual, char *code) {
    if (expected == actual) {
        printf("%s => %d\n", code, actual);
    } else {
        printf("%s => %d expected but got %d\n", code, expected, actual);
        exit(1);
    }
}

int ret3(){
    return 3;
    return 5;
}

int while_if1(){
    int i=0;
    while(i<10){
        if(i==0) return i; 
        return 11;
    }
}

int while_if2(){
    int i=0;
    while(i<10) {
        if(i<5) i=i+1;
        else return i;
    }
    return 11;
}

int for_if1(){
    int i=0;
    for(;i<=10;)
        if(i==0) return i;
    return 11;
}

int for_if2(){
    int i=0;
    for(;i<=10;)
        if(i<5) i=i+1;
        else return i;
    return 11;
}

int for_if3(){
    int i=0;
    for(;i<=10;)
        if(i<5) i=i+1;
        else return i;
    int ret;
    ret=11;
}

int three(){
    return 3;
}

int seven(){
    return 7;
}

int arg1(int a){
    return a;
}

int arg2(int a, int b){
    return a + b;
}

int assign(int a){
    return a = a + 1;
}

int fib(int n){
    if (n == 0) return 0;
    if (n == 1) return 1;
    return fib(n - 2) + fib(n - 1);
}

int foo(int *x, int y){
    return *x + y;
}

int main() {
    assert(0,({0&1;}),"{0&1;}");
    assert(1,({3&1;}),"{3&1;}");
    assert(3,({7&3;}),"{7&3;}");
    assert(10,({-1&10;}),"{-1&10;}");
    assert(1,({0|1;}),"{0|1;}");
    assert(0,({0^0;}),"{0^0;}");

    assert(47,({5+6*7;}),"{5+6*7;}");
    assert(15,({5* 3;}),"{5* 3;}");
    assert(7,({10 /2 + 2;}),"{10 /2 + 2;}");
    assert(15,({5*(9-6);}),"{5*(9-6);}");
    assert(4,({(3+5)/2;}),"{(3+5)/2;}");
    assert(5,({-10+15;}),"{-10+15;}");
    assert(3,({-(5+2)+10;}),"{-(5+2)+10;}");
    assert(10,({-10+20;}),"{-10+20;}");
    assert(10,({- -10;}),"{- -10;}");
    assert(10,({- - +10;}),"{- - +10;}");

    assert(0,({ 1 < 1;}),"{ 1 < 1;}");
    assert(0,({ 2 < 1;}),"{ 2 < 1;}");
    assert(1,({ 1 < 2;}),"{ 1 < 2;}");
    assert(0,({ 1 > 1;}),"{ 1 > 1;}");
    assert(1,({ 2 > 1;}),"{ 2 > 1;}");
    assert(0,({ 1 > 2;}),"{ 1 > 2;}");
    assert(1,({ 1 <= 1;}),"{ 1 <= 1;}");
    assert(0,({ 2 <= 1;}),"{ 2 <= 1;}");
    assert(1,({ 1 <= 2;}),"{ 1 <= 2;}");
    assert(1,({ 1 >= 1;}),"{ 1 >= 1;}");
    assert(1,({ 2 >= 1;}),"{ 2 >= 1;}");
    assert(0,({ 1 >= 2;}),"{ 1 >= 2;}");
    assert(1,({ 5 == 2 + 3;}),"{ 5 == 2 + 3;}");
    assert(0,({ 2 + 3 != 5;}),"{ 2 + 3 != 5;}");

    assert(30,({int a;a=30; a;}),"{int a;a=30; a;}");
    assert(24,({int a;a=9+15; a;}),"{int a;a=9+15; a;}");
    assert(3, ret3(),"ret3()");
    assert(3,({int a;int b;a=1;b=2; a+b;}),"{int a;int b;a=1;b=2; a+b;}");
    assert(4,({int a;int b;int c;a=b=2;c=a+b; c;}),"{int a;int b;int c;a=b=2;c=a+b; c;}");
    assert(7,({int a; a=4+3; a ;}),"{int a; a=4+3; a ;}");
    assert(6,({int foo; int bar;foo=1;bar=2+3; foo + bar;}),"{int foo; int bar;foo=1;bar=2+3; foo + bar;}");

    assert(2,({int x = 0; if(1<10) x = 2; x;}),"{int x = 0; if(1<10) x = 2; x;}");
    assert(10,({int var; var=1;if(1<10) var=10; var;}),"{int var; var=1;if(1<10) var=10; var;})");
    assert(1,({int var; var=1;if(1>10) var=10; var;}),"{int var; var=1;if(1>10) var=10; var;}");
    assert(2,({int x = 0; if(1<10) x = 2; else x = 3; x;}),"{int x = 0; if(1<10) x = 2; else x = 3; x;}");
    assert(3,({int x = 0; if(11<10) x = 2; else x = 3; x;}),"{int x = 0; if(11<10) x = 2; else x = 3; x;}");
    assert(2,({int x = 0; if(1<10) { x = 2;} else { x = 3;} x;}),"{int x = 0; if(1<10) { x = 2;} else { x = 3;} x;}");
    assert(3,({int x = 0; if(11<10) { x = 2;} else { x = 3;} x;}),"{int x = 0; if(11<10) { x = 2;} else { x = 3;} x;}");

    assert(2,({0?1:2;}),"{0?1:2;}");
    assert(1,({1?1:2;}),"{1?1:2;}");
    assert(3,({1,2,3;}),"{1,2,3;}");    
    
    assert(10,({int i=0;while(i<10)i=i+1; i;}),"{int i=0;while(i<10)i=i+1; i;}");
    assert(10,({int i=0;while(i<10){i=i+1;} i;}),"{int i=0;while(i<10){i=i+1;} i;}");
    assert(0,while_if1(),"while_if1()");
    assert(5,while_if2(),"while_if2()");

    assert(55,({int i=0; int j=0; for (i=0; i<=10; i=i+1) j=i+j; j; })," { int i=0; int j=0; for (i=0; i<=10; i=i+1) j=i+j; j; }");
    assert(20,({int i;int a; a=10;for(i=0;i<10;i=i+1)a=a+1; a;}),"{int i;int a; a=10;for(i=0;i<10;i=i+1)a=a+1; return a;}");
    assert(11,({int i; i=0;for(;i<=10;)i=i+1; i;}),"{int i; i=0;for(;i<=10;)i=i+1;return i;}");
    assert(0,for_if1(),"for_if1()");
    assert(5,for_if2(),"for_if2()");
    assert(5,for_if3(),"for_if3()");

    assert(10,({three() + seven();}),"{return three() + seven();}");

    assert(5,({arg1(5);}),"{arg1(5);}");
    assert(10,({arg2(0, 10);}),"{arg2(0, 10);}");
    assert(10,({arg2(10, 0);}),"{arg2(10, 0);}");
    assert(10,({arg2(2*2,2+4);}),"{arg2(2*2,2+4);}");

    assert(1,assign(0),"assign(0)");

    assert(55,fib(10),"fib(10)");

    assert(3,({int x;int *y;y = &x;*y = 3;x;}),"{int x;int *y;y = &x;*y = 3;x;}");
    assert(3,({int x=3; *&x;}),"{int x=3; *&x;}");
    assert(3,({int x=3; int *y=&x; int **z=&y; **z;}),"{int x=3; int *y=&x; int **z=&y; **z;}");
    assert(5,({int x=3; int y=5; *(&x+1);}),"{int x=3; int y=5; *(&x+1);}");
    assert(5,({int x=3; int y=5; *(1+&x);}),"{int x=3; int y=5; *(1+&x);}");
    assert(3,({int x=3; int y=5; *(&y-1);}),"{int x=3; int y=5; *(&y-1);}");
    assert(2,({int x=3; (&x+2)-&x;}),"{int x=3; (&x+2)-&x;}");
    assert(5,({int x=3; int y=5; int *z=&x; *(z+1);}),"{int x=3; int y=5; int *z=&x; *(z+1);}");
    assert(3,({int x=3; int y=5; int *z=&y; *(z-1);}),"{int x=3; int y=5; int *z=&y; *(z-1);}");
    assert(5,({int x=3; int *y=&x; *y=5; x;}),"{int x=3; int *y=&x; *y=5; x;}");
    assert(7,({int x=3; int y=5; *(&x+1)=7; y;}),"{int x=3; int y=5; *(&x+1)=7; y;}");
    assert(7,({int x=3; int y=5; *(&y-1)=7; x;}),"{int x=3; int y=5; *(&y-1)=7; x;}");
    assert(8,({int x=3; int y=5; *&x + y;}),"{int x=3; int y=5; *&x + y;}");

    assert(4,({int x=3; sizeof(x);}),"{int x=3; sizeof(x);}");
    assert(4,({int x=3; sizeof x;}),"{int x=3; sizeof x;}");
    assert(8,({int x=3; sizeof(&x);}),"{int x=3; sizeof(&x);}");

    assert(3,({int x[2]; int *y=&x; *y=3; *x;}),"{int x[2]; int *y=&x; *y=3; *x;}");
    assert(3,({int a[2]; *a = 1; *(a + 1) = 2; int *p; p = a; *p + *(p + 1);}),"{int a[2]; *a = 1; *(a + 1) = 2; int *p; p = a; *p + *(p + 1);}");

    assert(3,({int x[3]; *x=3; *(x+1)=4; *(x+2)=5; *x;}),"{int x[3]; *x=3; *(x+1)=4; *(x+2)=5; *x;}");
    assert(4,({int x[3]; *x=3; *(x+1)=4; *(x+2)=5; *(x+1);}),"{int x[3]; *x=3; *(x+1)=4; *(x+2)=5; *(x+1);}");
    assert(5,({int x[3]; *x=3; *(x+1)=4; *(x+2)=5; *(x+2);}),"{int x[3]; *x=3; *(x+1)=4; *(x+2)=5; *(x+2);}");

    assert(3,({int x[3]; x[0]=3; x[1]=4; x[2]=5; *x;}),"{int x[3]; x[0]=3; x[1]=4; x[2]=5; *x;}");
    assert(4,({int x[3]; x[0]=3; x[1]=4; x[2]=5; *(x+1);}),"{int x[3]; x[0]=3; x[1]=4; x[2]=5; *(x+1);}");
    assert(5,({int x[3]; x[0]=3; x[1]=4; x[2]=5; *(x+2);}),"{int x[3]; x[0]=3; x[1]=4; x[2]=5; *(x+2);}");

    assert(7,({int x; char y; int a=&x; int b=&y; b-a;}),"{int x; char y; int a=&x; int b=&y; b-a;}");
    assert(1,({char x; int y; int a=&x; int b=&y; b-a;}),"{char x; int y; int a=&x; int b=&y; b-a;}");

    printf("OK\n");
    return 0;
}
